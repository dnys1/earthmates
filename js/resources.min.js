function escapeHtml(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}function loadResources(e,t,s){resources=[],$("table>tbody").empty(),$.ajax({type:"GET",url:"ajax/get_resources.php",data:{cat:e,sub:t,typ:s},cache:!1,success:function(e){if(e)if(resources=JSON.parse(e),0==resources.length)$(".resources-table").hide(),$("#resources-message").hide(),$("#no-resources").show();else{$("#resources-message").hide(),$(".resources-table").show(),$("#no-resources").hide();for(var t=0;t<resources.length;t++){var r,o=null==resources[t].Subtitle?"":resources[t].Subtitle,a=null==resources[t].Description?"Description not available.":resources[t].Description;switch(s){case"1":r=resources[t].AmazonReferral;break;case"2":r=null!=resources[t].AmazonLink?'<a target="_blank" href="'+resources[t].AmazonLink+'"><img class="img-responsive" src="'+resources[t].ImageLink+'" />':'<img class="img-responsive" src="'+resources[t].ImageLink+'" />';var i="";break;case"3":console.log("web");break;case"4":console.log("article")}var i="";i+="<tr>",i+='<td><div class="referral">'+r+"</div></td>",i+="<td>",i+='<div class="description">',i+="<h2>"+resources[t].Title+" <small>"+o+"</small></h3>",i+="<p><i>"+resources[t].Author+"</i></p>",i+='<p class="resource-description">'+a+"</p>",i+='<p class="resource-links">',null!=resources[t].AmazonLink&&(i+='<a target="_blank" href="'+resources[t].AmazonLink+'">Amazon</a>&emsp;'),null!=resources[t].WebLink&&(i+='<a target="_blank" href="'+resources[t].WebLink+"\">Author's Site</a>"),i+="</p>",i+="</div>",i+="</td>",i+='<td class="rating"><div class="center-block">',i+='<p class="tiny-description"><b>'+resources[t].Title+"</b><br>"+resources[t].Author+"<br></p>",i+='<ul class="c-rating"></ul>',i+='<p class="rating-info"></p>',i+="</div></td>",i+="</tr>",$("table>tbody").append(i),$("table a").attr("target","_blank")}resize();for(var n=$(".rating .c-rating"),c=$(".rating .rating-info"),t=0;t<n.length;t++){var l=t,u=n[t],d=resources[t].Rating,p=5,g=resources[t].ID,f=function(e,t,s){postRating(parseInt(t),e,s)},h=(rating(u,d,p,f,g,l),resources[t].RatingCount);c[t].innerHTML=1==h?"1 rating":0==h?"No ratings":h+" ratings"}}}})}function postRating(e,t,s){$.ajax({type:"POST",url:"ajax/post_resource_rating.php",data:{resource:e,rating:t},success:function(t){console.log("Setting data for resource "+e);var r=$(".rating-info");r[s].innerHTML=t}})}function loadTypes(){$.ajax({type:"GET",url:"ajax/get_types.php",cache:!1,success:function(e){types=JSON.parse(e)}})}function loadCategories(){$.ajax({type:"GET",url:"ajax/get_categories.php",cache:!1,success:function(e){categories=JSON.parse(e)}})}function fillCategories(){$("#categories").append('<option data-index="-1" value="0" selected="selected"></option>'),$("#categories").append('<option data-index="-1" value="all">All</option>');for(var e=0;e<categories.length;e++)$("#categories").append('<option data-index="'+e+'" value="'+categories[e].ID+'">'+categories[e].Category+"</option>")}function fillSubcategories(){var e=$("#categories").find(":selected").data("index");if(-1!=e){subcategories=categories[e].Subcategories,console.log(subcategories),$("#subcategories").append('<option data-index="-1" value="0" selected="selected"></option>'),$("#subcategories").append('<option data-index="-1" value="all">All</option>'),console.log(subcategories.length);for(var t=0;t<subcategories.length;t++)$("#subcategories").append('<option data-index="'+t+'" value="'+subcategories[t].ID+'">'+subcategories[t].Subcategory+"</option>");$(".subcategories").show()}}function fillTypes(){if(0!=$("#subcategories").val()||0==$("#categories").val()){$("#types").append('<option data-index="-1" value="0" selected="selected"></option>');for(var e=0;e<types.length;e++)$("#types").append('<option data-index="'+e+'" value="'+types[e].ID+'">'+types[e].Type+"</option>");$("#types").one("change",function(){console.log("Type changed"),0!=$("#types").val()&&fillResources()}),$(".types").show()}}function fillResources(){var e=$("#categories").val(),t=$("#subcategories").val(),s=$("#types").val();(0!=t||0!=s)&&0!=s&&null!=s&&loadResources(e,t,s)}function resize(){var e=$(window).width();if(console.log(e),700>e){console.log("here"),$(".resources-table>tbody>tr>td:nth-of-type(2)").hide(),$(".resources-table>thead>tr>th:nth-of-type(2)").hide(),$(".tiny-description").show();for(var t,s=0,r=$(".resources-table img"),o=0;o<r.length;o++){var a=r[o].width;a>s&&(s=a)}t=e-s,$(".rating").width(t)}else $(".rating").width(150),$(".resources-table>tbody>tr>td:nth-of-type(2)").show(),$(".resources-table>thead>tr>th:nth-of-type(2)").show(),$(".tiny-description").hide()}!function(){"use strict";function e(e,t,s,r,o,a){function i(e,t){for(var s=0;s<e.length;s++){var r=e[s];t(r,s)}}function n(e){c(e),l(e),u(e)}function c(e){e.addEventListener("mouseover",function(t){i(g,function(t,s){s<=parseInt(e.getAttribute("data-index"))?t.classList.add("is-active"):t.classList.remove("is-active")})})}function l(e){e.addEventListener("mouseout",function(e){-1===g.indexOf(e.relatedTarget)&&d(null,!1)})}function u(e){e.addEventListener("click",function(t){t.preventDefault(),d(parseInt(e.getAttribute("data-index"))+1,!0)})}function d(e,n){e&&0>e||e>s||(void 0===n&&(n=!0),t=e||t,i(g,function(e,s){t>s?e.classList.add("is-active"):e.classList.remove("is-active")}),r&&n&&r(p(),o,a))}function p(){return t}var g=[];return function(){if(!e)throw Error("No element supplied.");if(!s)throw Error("No max rating supplied.");if(t||(t=0),0>t||t>s)throw Error("Current rating is out of bounds.");for(var r=0;s>r;r++){var o=document.createElement("li");o.classList.add("c-rating__item"),o.setAttribute("data-index",r),t>r&&o.classList.add("is-active"),e.appendChild(o),g.push(o),n(o)}}(),{setRating:d,getRating:p}}window.rating=e}();var resources=[],categories=[],types=[],subcategories;$(document).ready(function(){loadCategories(),loadTypes(),$(".subcategories").hide(),$(".types").hide(),$(".resources-table").hide(),$("#no-resources").hide(),$("#resources-message").show(),$(window).on("resize",resize),window.addEventListener("orientationchange",resize,!1)}),$(document).one("ajaxStop",function(){$(".resources-table");$("#categories").is(":empty")&&fillCategories(),$("#categories").change(function(){console.log("Category changed"),$("#subcategories").empty(),$(".subcategories").hide(),$("#types").empty(),$(".types").hide(),0!=$("#categories").val()&&(fillSubcategories(),fillTypes(),fillResources())}),$("#subcategories").change(function(){console.log("Subcategory changed"),$("#types").empty(),$(".types").hide(),0!=$("#subcategories").val()&&(fillTypes(),fillResources())})});